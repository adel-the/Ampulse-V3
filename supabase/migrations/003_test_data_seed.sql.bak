-- ====================================
-- SCRIPT DE DONNÉES DE TEST
-- SoliReserve Enhanced - Données réalistes
-- ====================================

-- ====================================
-- 1. DONNÉES POUR USERS
-- ====================================

INSERT INTO public.users (id, email, nom, prenom, telephone, role, hotel_id, statut, permissions) VALUES
-- Admin système
('00000000-0000-0000-0000-000000000001', 'admin@solireserve.fr', 'Dubois', 'Jean', '01.23.45.67.89', 'admin', NULL, 'actif', '{"all": true}'::jsonb),

-- Utilisateurs Hôtel Le Refuge (ID: 1)
('00000000-0000-0000-0000-000000000002', 'manager.refuge@solireserve.fr', 'Martin', 'Sophie', '02.34.56.78.90', 'manager', 1, 'actif', '{"hotel_management": true}'::jsonb),
('00000000-0000-0000-0000-000000000003', 'comptable.refuge@solireserve.fr', 'Durand', 'Pierre', '02.34.56.78.91', 'comptable', 1, 'actif', '{"finances": true}'::jsonb),
('00000000-0000-0000-0000-000000000004', 'reception.refuge@solireserve.fr', 'Moreau', 'Marie', '02.34.56.78.92', 'receptionniste', 1, 'actif', '{"reception": true}'::jsonb),

-- Utilisateurs Hôtel Social Horizon (ID: 2)
('00000000-0000-0000-0000-000000000005', 'manager.horizon@solireserve.fr', 'Leroy', 'Antoine', '03.45.67.89.01', 'manager', 2, 'actif', '{"hotel_management": true}'::jsonb),
('00000000-0000-0000-0000-000000000006', 'reception.horizon@solireserve.fr', 'Bernard', 'Claire', '03.45.67.89.02', 'receptionniste', 2, 'actif', '{"reception": true}'::jsonb)
ON CONFLICT (id) DO NOTHING;

-- ====================================
-- 2. DONNÉES POUR HOTELS
-- ====================================

INSERT INTO public.hotels (id, nom, adresse, ville, code_postal, telephone, email, gestionnaire, statut, type_etablissement, directeur, telephone_directeur, email_directeur, description, check_in_time, check_out_time, classement_etoiles, nombre_etages, parking_places, capacite) VALUES

-- Hôtel Le Refuge
(1, 'Hôtel Le Refuge', '15 rue de la Solidarité', 'Paris', '75011', '01.42.33.44.55', 'contact@hotel-refuge.fr', 'Sophie Martin', 'ACTIF', 'hotel', 'Jean-Claude Moreau', '01.42.33.44.56', 'direction@hotel-refuge.fr', 'Hôtel social au cœur de Paris, spécialisé dans l''hébergement d''urgence et la réinsertion sociale. Établissement convivial avec services d''accompagnement.', '14:00', '11:00', 2, 3, 5, 45),

-- Hôtel Social Horizon  
(2, 'Résidence Social Horizon', '28 avenue de l''Espoir', 'Lyon', '69003', '04.78.45.66.77', 'accueil@horizon-lyon.fr', 'Antoine Leroy', 'ACTIF', 'residence', 'Marie-Claire Dubois', '04.78.45.66.78', 'direction@horizon-lyon.fr', 'Résidence sociale moderne offrant un hébergement temporaire de qualité. Accompagnement personnalisé vers le logement autonome.', '15:00', '10:00', 3, 4, 12, 60),

-- Centre d'Hébergement Marseille
(3, 'CHRS Les Oliviers', '45 boulevard de la Méditerranée', 'Marseille', '13001', '04.91.22.33.44', 'administration@chrs-oliviers.fr', 'Patrick Fernandez', 'ACTIF', 'chrs', 'Sylvie Rossi', '04.91.22.33.45', 'direction@chrs-oliviers.fr', 'Centre d''hébergement et de réinsertion sociale situé proche du centre-ville. Accompagnement global vers l''autonomie.', '16:00', '09:00', NULL, 2, 8, 30),

-- Foyer Jeunes Travailleurs
(4, 'FJT Nouvelle Vie', '12 rue du Progrès', 'Toulouse', '31000', '05.61.77.88.99', 'contact@fjt-nouvellevie.fr', 'Isabelle Garnier', 'ACTIF', 'foyer', 'Michel Blanc', '05.61.77.89.00', 'direction@fjt-nouvellevie.fr', 'Foyer de jeunes travailleurs proposant hébergement et accompagnement pour l''insertion professionnelle des 16-30 ans.', '17:00', '08:00', NULL, 5, 15, 80)

ON CONFLICT (id) DO NOTHING;

-- ====================================
-- 3. DONNÉES POUR ROOM_CATEGORIES
-- ====================================

INSERT INTO public.room_categories (hotel_id, name, description, base_price, max_occupancy, amenities, display_order) VALUES

-- Catégories pour Hôtel Le Refuge (ID: 1)
(1, 'Chambre Simple', 'Chambre individuelle avec lavabo, douche commune à l''étage', 35.00, 1, '["Lavabo", "Mobilier de base", "Chauffage", "Fenêtre"]'::jsonb, 1),
(1, 'Chambre Double Standard', 'Chambre pour deux personnes avec salle d''eau privée', 55.00, 2, '["Salle d''eau privée", "Mobilier complet", "Chauffage", "TV"]'::jsonb, 2),
(1, 'Chambre Familiale', 'Chambre spacieuse pour famille avec enfants', 75.00, 4, '["Salle d''eau privée", "Mobilier familial", "Réfrigérateur", "TV", "Espace détente"]'::jsonb, 3),
(1, 'Chambre PMR', 'Chambre adaptée aux personnes à mobilité réduite', 45.00, 2, '["Accès PMR", "Salle d''eau adaptée", "Équipements spécialisés", "Alarme visuelle"]'::jsonb, 4),

-- Catégories pour Résidence Social Horizon (ID: 2)
(2, 'Studio Individuel', 'Studio équipé avec kitchenette et salle d''eau', 28.00, 1, '["Kitchenette équipée", "Salle d''eau privée", "Mobilier complet", "WiFi", "Balcon"]'::jsonb, 1),
(2, 'Appartement T2', 'Deux pièces avec salon séparé et cuisine équipée', 45.00, 2, '["Cuisine équipée", "Salon séparé", "Salle d''eau", "Balcon", "WiFi", "TV"]'::jsonb, 2),
(2, 'Appartement T3', 'Trois pièces pour famille avec 2 chambres', 65.00, 4, '["Cuisine équipée", "2 chambres", "Salon", "Salle de bain", "Balcon", "WiFi"]'::jsonb, 3),

-- Catégories pour CHRS Les Oliviers (ID: 3)
(3, 'Chambre d''Insertion', 'Chambre dans le cadre du parcours d''insertion sociale', 25.00, 1, '["Mobilier de base", "Lavabo", "Chauffage", "Armoire sécurisée"]'::jsonb, 1),
(3, 'Chambre de Stabilisation', 'Chambre pour personnes en phase de stabilisation', 30.00, 1, '["Salle d''eau privée", "Mobilier complet", "Réfrigérateur", "Bureau"]'::jsonb, 2),

-- Catégories pour FJT Nouvelle Vie (ID: 4)
(4, 'Chambre Étudiant', 'Chambre pour étudiant avec bureau et WiFi', 22.00, 1, '["Bureau d''étude", "WiFi haut débit", "Salle d''eau privée", "Rangements"]'::jsonb, 1),
(4, 'Chambre Jeune Travailleur', 'Chambre confortable pour jeune actif', 26.00, 1, '["Mobilier moderne", "Salle d''eau privée", "WiFi", "Mini-réfrigérateur", "TV"]'::jsonb, 2),
(4, 'Studio Autonome', 'Studio avec kitchenette pour plus d''autonomie', 32.00, 1, '["Kitchenette", "Salle d''eau privée", "WiFi", "Mobilier complet", "Balcon"]'::jsonb, 3)

ON CONFLICT (hotel_id, name) DO NOTHING;

-- ====================================
-- 4. DONNÉES POUR ROOMS
-- ====================================

INSERT INTO public.rooms (hotel_id, numero, type, prix, statut, description, category_id, floor, room_size, bed_type, amenities, last_cleaned) VALUES

-- Chambres Hôtel Le Refuge (ID: 1)
(1, '101', 'Simple', 35.00, 'disponible', 'Chambre simple au rez-de-chaussée', 1, 1, 12.00, 'simple', '["Lavabo", "Mobilier de base", "Chauffage"]'::jsonb, CURRENT_DATE - INTERVAL '2 days'),
(1, '102', 'Simple', 35.00, 'occupee', 'Chambre simple avec vue jardin', 1, 1, 12.00, 'simple', '["Lavabo", "Mobilier de base", "Chauffage", "Vue jardin"]'::jsonb, CURRENT_DATE - INTERVAL '1 day'),
(1, '103', 'Double Standard', 55.00, 'disponible', 'Chambre double confortable', 2, 1, 18.00, 'double', '["Salle d''eau privée", "TV", "Chauffage"]'::jsonb, CURRENT_DATE),
(1, '104', 'PMR', 45.00, 'disponible', 'Chambre adaptée PMR', 4, 1, 20.00, 'simple', '["Accès PMR", "Salle d''eau adaptée", "Alarme visuelle"]'::jsonb, CURRENT_DATE - INTERVAL '1 day'),
(1, '201', 'Double Standard', 55.00, 'occupee', 'Chambre double étage avec balcon', 2, 2, 18.00, 'double', '["Salle d''eau privée", "TV", "Balcon"]'::jsonb, CURRENT_DATE - INTERVAL '3 days'),
(1, '202', 'Familiale', 75.00, 'disponible', 'Grande chambre familiale', 3, 2, 25.00, 'multiple', '["Salle d''eau privée", "Réfrigérateur", "TV", "Espace détente"]'::jsonb, CURRENT_DATE),
(1, '203', 'Double Standard', 55.00, 'maintenance', 'Chambre en rénovation', 2, 2, 18.00, 'double', '["Salle d''eau privée", "TV"]'::jsonb, NULL),
(1, '301', 'Simple', 35.00, 'disponible', 'Chambre simple dernier étage', 1, 3, 12.00, 'simple', '["Lavabo", "Mobilier de base", "Vue panoramique"]'::jsonb, CURRENT_DATE),

-- Chambres Résidence Social Horizon (ID: 2)
(2, 'A101', 'Studio Individuel', 28.00, 'occupee', 'Studio moderne avec balcon', 5, 1, 25.00, 'simple', '["Kitchenette", "Salle d''eau", "Balcon", "WiFi"]'::jsonb, CURRENT_DATE - INTERVAL '1 day'),
(2, 'A102', 'Studio Individuel', 28.00, 'disponible', 'Studio lumineux côté sud', 5, 1, 25.00, 'simple', '["Kitchenette", "Salle d''eau", "Balcon", "WiFi"]'::jsonb, CURRENT_DATE),
(2, 'A201', 'Appartement T2', 45.00, 'occupee', 'T2 avec grand salon', 6, 2, 45.00, 'double', '["Cuisine équipée", "Salon", "Balcon", "WiFi", "TV"]'::jsonb, CURRENT_DATE - INTERVAL '2 days'),
(2, 'A202', 'Appartement T3', 65.00, 'disponible', 'T3 familial avec vue', 7, 2, 65.00, 'multiple', '["Cuisine équipée", "2 chambres", "Salon", "Balcon"]'::jsonb, CURRENT_DATE),
(2, 'B101', 'Studio Individuel', 28.00, 'disponible', 'Studio calme côté cour', 5, 1, 25.00, 'simple', '["Kitchenette", "Salle d''eau", "WiFi"]'::jsonb, CURRENT_DATE - INTERVAL '1 day'),

-- Chambres CHRS Les Oliviers (ID: 3)
(3, '10', 'Insertion', 25.00, 'occupee', 'Chambre d''insertion parcours social', 8, 1, 10.00, 'simple', '["Mobilier de base", "Lavabo", "Armoire sécurisée"]'::jsonb, CURRENT_DATE - INTERVAL '1 day'),
(3, '11', 'Insertion', 25.00, 'disponible', 'Chambre d''insertion avec fenêtre', 8, 1, 10.00, 'simple', '["Mobilier de base", "Lavabo", "Armoire sécurisée"]'::jsonb, CURRENT_DATE),
(3, '20', 'Stabilisation', 30.00, 'occupee', 'Chambre de stabilisation avec bureau', 9, 2, 15.00, 'simple', '["Salle d''eau privée", "Bureau", "Réfrigérateur"]'::jsonb, CURRENT_DATE - INTERVAL '2 days'),
(3, '21', 'Stabilisation', 30.00, 'disponible', 'Chambre de stabilisation calme', 9, 2, 15.00, 'simple', '["Salle d''eau privée", "Bureau", "Réfrigérateur"]'::jsonb, CURRENT_DATE),

-- Chambres FJT Nouvelle Vie (ID: 4)
(4, '1A01', 'Étudiant', 22.00, 'occupee', 'Chambre étudiant avec grand bureau', 10, 1, 15.00, 'simple', '["Bureau d''étude", "WiFi", "Salle d''eau", "Rangements"]'::jsonb, CURRENT_DATE - INTERVAL '1 day'),
(4, '1A02', 'Étudiant', 22.00, 'disponible', 'Chambre étudiant lumineuse', 10, 1, 15.00, 'simple', '["Bureau d''étude", "WiFi", "Salle d''eau", "Rangements"]'::jsonb, CURRENT_DATE),
(4, '2B01', 'Jeune Travailleur', 26.00, 'occupee', 'Chambre jeune travailleur moderne', 11, 2, 18.00, 'simple', '["Mobilier moderne", "WiFi", "TV", "Mini-réfrigérateur"]'::jsonb, CURRENT_DATE),
(4, '3C01', 'Studio Autonome', 32.00, 'disponible', 'Studio autonome avec balcon', 12, 3, 22.00, 'simple', '["Kitchenette", "Balcon", "WiFi", "Mobilier complet"]'::jsonb, CURRENT_DATE - INTERVAL '1 day')

ON CONFLICT (hotel_id, numero) DO NOTHING;

-- ====================================
-- 5. DONNÉES POUR OPERATEURS_SOCIAUX
-- ====================================

INSERT INTO public.operateurs_sociaux (nom, prenom, organisation, telephone, email, statut, specialite, zone_intervention, adresse, responsable, telephone_responsable, email_responsable, agrement, date_agrement, specialites, partenariats) VALUES

('Duchemin', 'Valérie', 'CCAS de Paris', '01.42.76.40.40', 'v.duchemin@ccas-paris.fr', 'actif', 'Hébergement d''urgence', 'Paris 11ème, 12ème, 20ème', '3 rue de Rivoli, 75004 Paris', 'Marc Lefebvre', '01.42.76.40.41', 'm.lefebvre@ccas-paris.fr', 'AGR-CCAS-2020-001', '2020-03-15', '["Hébergement d''urgence", "Accompagnement social", "Insertion professionnelle"]', '["SAMU Social", "Croix-Rouge", "Emmaüs"]'),

('Rousseau', 'Philippe', 'Association Aurore', '01.45.84.85.86', 'p.rousseau@aurore.asso.fr', 'actif', 'Insertion par le logement', 'Paris, Petite Couronne', '43 rue de la République, 75011 Paris', 'Catherine Moreau', '01.45.84.85.87', 'c.moreau@aurore.asso.fr', 'AGR-AUR-2019-007', '2019-11-22', '["Logement accompagné", "Santé mentale", "Addictologie"]', '["Fondation Abbé Pierre", "DAL", "Médecins du Monde"]'),

('Martinez', 'Carmen', 'ADOMA Rhône', '04.78.63.45.67', 'c.martinez@adoma.fr', 'actif', 'Logement social temporaire', 'Métropole de Lyon', '18 cours Gambetta, 69007 Lyon', 'Jean-Luc Faure', '04.78.63.45.68', 'jl.faure@adoma.fr', 'AGR-ADO-2021-003', '2021-01-10', '["Hébergement temporaire", "Accueil familial", "Migrants"]', '["Forum Réfugiés", "Habitat et Humanisme", "ALPIL"]'),

('Benali', 'Karim', 'CIAS Marseille Métropole', '04.91.55.12.34', 'k.benali@cias-marseille.fr', 'actif', 'Urgence sociale', 'Marseille, Aix-en-Provence', '58 La Canebière, 13001 Marseille', 'Sophie Blanc', '04.91.55.12.35', 's.blanc@cias-marseille.fr', 'AGR-CIAS-2020-012', '2020-07-03', '["Urgence sociale", "Familles", "Femmes victimes"]', '["AVIEM", "SOS Femmes", "Secours Catholique"]'),

('Girard', 'Stéphanie', 'Mission Locale Toulouse', '05.61.21.43.65', 's.girard@mltoulouse.fr', 'actif', 'Insertion jeunes', 'Toulouse Métropole', '15 rue des Arts, 31000 Toulouse', 'Pierre Lemoine', '05.61.21.43.66', 'p.lemoine@mltoulouse.fr', 'AGR-ML-2019-008', '2019-09-14', '["Insertion professionnelle", "Jeunes 16-25 ans", "Formation"]', '["Pôle Emploi", "CROUS", "Unis-Cité"]'),

('Fernandez', 'Miguel', 'Croix-Rouge Française', '04.91.45.67.89', 'm.fernandez@croix-rouge.fr', 'actif', 'Urgence et précarité', 'Bouches-du-Rhône', '12 boulevard National, 13003 Marseille', 'Françoise Durand', '04.91.45.67.90', 'f.durand@croix-rouge.fr', 'AGR-CRF-2021-005', '2021-05-18', '["Urgence sociale", "Santé", "Migrants"]', '["MSF", "Médecins du Monde", "France Terre d''Asile"]')

ON CONFLICT DO NOTHING;

-- ====================================
-- 6. DONNÉES POUR CLIENTS/USAGERS
-- ====================================

INSERT INTO public.clients (nom, prenom, email, telephone, adresse, ville, code_postal, date_naissance, situation_familiale, nombre_enfants, revenus, prestations, notes) VALUES

('Moreau', 'Sarah', 'sarah.moreau@email.fr', '06.12.34.56.78', '23 rue des Lilas', 'Paris', '75011', '1985-03-15', 'Célibataire', 0, 800.00, '["RSA", "CAF"]', 'Recherche emploi dans la restauration'),

('Ahmed', 'Omar', 'o.ahmed@email.fr', '06.23.45.67.89', '45 avenue de la République', 'Lyon', '69003', '1978-11-22', 'Marié', 2, 1200.00, '["Allocation familiale", "Prime d''activité"]', 'Formation en cours - électricien'),

('Dubois', 'Martine', 'martine.dubois@email.fr', '06.34.56.78.90', '67 rue du Progrès', 'Marseille', '13001', '1962-07-08', 'Divorcée', 1, 950.00, '["ASS", "CAF"]', 'Cherche logement stable, enfant scolarisé'),

('Petit', 'Lucas', 'lucas.petit@email.fr', '06.45.67.89.01', '12 impasse du Bonheur', 'Toulouse', '31000', '1995-12-03', 'Célibataire', 0, 600.00, '["RSA jeune", "Mission locale"]', 'Étudiant en alternance, BTS informatique'),

('Garcia', 'Elena', 'elena.garcia@email.fr', '06.56.78.90.12', '89 boulevard des Nations', 'Paris', '75020', '1990-04-18', 'Concubinage', 1, 1100.00, '["Allocation familiale", "APL"]', 'Employée à temps partiel, cherche garde d''enfant'),

('Konaté', 'Amadou', 'amadou.konate@email.fr', '06.67.89.01.23', '34 rue de l''Espoir', 'Lyon', '69007', '1983-09-30', 'Marié', 3, 1500.00, '["Allocation familiale", "Prime d''activité"]', 'Ouvrier du bâtiment, famille nombreuse'),

('Lemaire', 'Céline', 'celine.lemaire@email.fr', '06.78.90.12.34', '56 cours de la Liberté', 'Marseille', '13008', '1975-01-25', 'Veuve', 2, 850.00, '["Pension de réversion", "CAF"]', 'Cherche formation pour retour à l''emploi'),

('Nguyen', 'Linh', 'linh.nguyen@email.fr', '06.89.01.23.45', '78 rue de la Paix', 'Toulouse', '31200', '1992-08-14', 'Célibataire', 0, 750.00, '["RSA", "Formation professionnelle"]', 'Apprentissage du français, formation couture')

ON CONFLICT DO NOTHING;

-- Copie des clients vers usagers pour compatibilité
INSERT INTO public.usagers (nom, prenom, date_naissance, adresse, telephone, email, situation_familiale, nombre_enfants, revenus, prestations)
SELECT nom, prenom, date_naissance, adresse, telephone, email, situation_familiale, nombre_enfants, revenus, prestations
FROM public.clients
ON CONFLICT DO NOTHING;

-- ====================================
-- 7. DONNÉES POUR CONVENTIONS_PRIX
-- ====================================

INSERT INTO public.conventions_prix (operateur_id, hotel_id, type_chambre, prix_conventionne, prix_standard, reduction, date_debut, date_fin, statut, conditions) VALUES

-- Conventions pour Hôtel Le Refuge
(1, 1, 'Simple', 30.00, 35.00, 14.29, '2024-01-01', '2024-12-31', 'active', 'Convention cadre CCAS Paris - Tarif préférentiel pour hébergement d''urgence'),
(1, 1, 'Double Standard', 45.00, 55.00, 18.18, '2024-01-01', '2024-12-31', 'active', 'Tarif famille CCAS Paris'),
(2, 1, 'Simple', 32.00, 35.00, 8.57, '2024-03-01', '2025-02-28', 'active', 'Convention Association Aurore - Insertion par le logement'),
(2, 1, 'Familiale', 65.00, 75.00, 13.33, '2024-03-01', '2025-02-28', 'active', 'Tarif familial Association Aurore'),

-- Conventions pour Résidence Social Horizon
(3, 2, 'Studio Individuel', 25.00, 28.00, 10.71, '2024-02-01', '2024-12-31', 'active', 'Convention ADOMA Rhône - Logement temporaire'),
(3, 2, 'Appartement T2', 40.00, 45.00, 11.11, '2024-02-01', '2024-12-31', 'active', 'Tarif T2 ADOMA'),
(3, 2, 'Appartement T3', 58.00, 65.00, 10.77, '2024-02-01', '2024-12-31', 'active', 'Tarif familial ADOMA'),

-- Conventions pour CHRS Les Oliviers
(4, 3, 'Insertion', 20.00, 25.00, 20.00, '2024-01-01', '2024-12-31', 'active', 'CIAS Marseille - Tarif insertion sociale'),
(4, 3, 'Stabilisation', 25.00, 30.00, 16.67, '2024-01-01', '2024-12-31', 'active', 'CIAS Marseille - Tarif stabilisation'),

-- Conventions pour FJT Nouvelle Vie
(5, 4, 'Étudiant', 18.00, 22.00, 18.18, '2024-09-01', '2025-08-31', 'active', 'Mission Locale Toulouse - Tarif étudiant/formation'),
(5, 4, 'Jeune Travailleur', 22.00, 26.00, 15.38, '2024-01-01', '2024-12-31', 'active', 'Mission Locale - Insertion professionnelle jeunes'),
(6, 4, 'Studio Autonome', 28.00, 32.00, 12.50, '2024-01-01', '2024-12-31', 'active', 'Croix-Rouge - Accompagnement vers l''autonomie')

ON CONFLICT DO NOTHING;

-- ====================================
-- 8. DONNÉES POUR RESERVATIONS
-- ====================================

INSERT INTO public.reservations (usager_id, chambre_id, hotel_id, date_arrivee, date_depart, statut, prescripteur, prix, duree, operateur_id, notes) VALUES

-- Réservations en cours
(1, 2, 1, '2024-08-10', '2024-09-10', 'EN_COURS', 'CCAS Paris - Urgence sociale', 30.00, 31, 1, 'Hébergement d''urgence - Recherche logement en cours'),
(2, 9, 2, '2024-08-15', '2024-11-15', 'EN_COURS', 'ADOMA Rhône - Logement temporaire', 25.00, 92, 3, 'Famille en attente relogement - Formation père en cours'),
(5, 11, 2, '2024-08-01', '2024-10-01', 'EN_COURS', 'ADOMA Rhône - Stabilisation', 40.00, 61, 3, 'Mère célibataire - Accompagnement vers emploi'),
(6, 10, 3, '2024-07-20', '2024-10-20', 'EN_COURS', 'CIAS Marseille - Insertion', 20.00, 92, 4, 'Homme en réinsertion - Suivi psychologique'),
(7, 13, 4, '2024-08-01', '2024-12-01', 'EN_COURS', 'Mission Locale Toulouse - Formation', 18.00, 122, 5, 'Étudiant BTS - Recherche stage'),

-- Réservations confirmées (futures)
(3, 4, 1, '2024-08-25', '2024-11-25', 'CONFIRMEE', 'CCAS Paris - Accès au logement', 45.00, 92, 1, 'Femme avec enfant - Logement social en cours'),
(4, 14, 4, '2024-09-01', '2024-06-30', 'CONFIRMEE', 'Mission Locale Toulouse - Alternance', 22.00, 302, 5, 'Étudiant en BTS informatique - Alternance confirmée'),
(8, 12, 2, '2024-09-15', '2024-12-15', 'CONFIRMEE', 'ADOMA Rhône - Accompagnement', 25.00, 91, 3, 'Formation professionnelle - Apprentissage français'),

-- Réservations terminées
(1, 1, 1, '2024-06-01', '2024-08-01', 'TERMINEE', 'CCAS Paris - Transitoire', 30.00, 61, 1, 'Hébergement temporaire terminé - Relogement réussi'),
(2, 8, 2, '2024-05-15', '2024-08-14', 'TERMINEE', 'ADOMA Rhône - Stabilisation', 25.00, 91, 3, 'Période de stabilisation terminée avec succès'),

-- Réservation annulée
(3, 6, 1, '2024-07-01', '2024-09-01', 'ANNULEE', 'CCAS Paris - Urgence', 55.00, 62, 1, 'Annulation - Solution trouvée ailleurs')

ON CONFLICT DO NOTHING;

-- ====================================
-- 9. DONNÉES POUR DOCUMENT_TEMPLATES
-- ====================================

INSERT INTO public.document_templates (nom, type, description, contenu, statut, format, variables) VALUES

('Bon de réservation standard', 'bon_reservation', 'Modèle standard de bon de réservation pour les établissements', 
'Bon de Réservation N° {{numero_reservation}}

Établissement: {{nom_hotel}}
Adresse: {{adresse_hotel}}

Réservation pour:
Nom: {{nom_usager}} {{prenom_usager}}
Chambre: {{numero_chambre}} ({{type_chambre}})
Du {{date_arrivee}} au {{date_depart}}
Durée: {{duree}} jours
Prix journalier: {{prix}}€

Prescripteur: {{prescripteur}}
Opérateur social: {{nom_operateur}}

Conditions générales applicables.', 
'actif', 'pdf', '{"numero_reservation": "text", "nom_hotel": "text", "adresse_hotel": "text", "nom_usager": "text", "prenom_usager": "text", "numero_chambre": "text", "type_chambre": "text", "date_arrivee": "date", "date_depart": "date", "duree": "number", "prix": "number", "prescripteur": "text", "nom_operateur": "text"}'::jsonb),

('Facture hébergement', 'facture', 'Modèle de facture pour l''hébergement social', 
'FACTURE N° {{numero_facture}}

{{nom_hotel}}
{{adresse_hotel}}
SIRET: {{siret}}

Facturé à:
{{nom_operateur}}
{{adresse_operateur}}

Période: {{date_debut}} - {{date_fin}}
Hébergement de: {{nom_usager}} {{prenom_usager}}
Chambre: {{numero_chambre}}
Nombre de jours: {{nb_jours}}
Prix unitaire: {{prix_unitaire}}€
TOTAL: {{montant_total}}€ TTC

Modalités de paiement: {{modalites_paiement}}', 
'actif', 'pdf', '{"numero_facture": "text", "nom_hotel": "text", "adresse_hotel": "text", "siret": "text", "nom_operateur": "text", "adresse_operateur": "text", "date_debut": "date", "date_fin": "date", "nom_usager": "text", "prenom_usager": "text", "numero_chambre": "text", "nb_jours": "number", "prix_unitaire": "number", "montant_total": "number", "modalites_paiement": "text"}'::jsonb),

('Prolongation de prise en charge', 'prolongation_reservation', 'Demande de prolongation de séjour', 
'DEMANDE DE PROLONGATION

Établissement: {{nom_hotel}}
Réservation N°: {{numero_reservation}}

Usager: {{nom_usager}} {{prenom_usager}}
Chambre actuelle: {{numero_chambre}}
Fin de prise en charge prévue: {{date_fin_actuelle}}
Nouvelle date de fin demandée: {{nouvelle_date_fin}}

Motif de la prolongation:
{{motif_prolongation}}

Opérateur demandeur: {{nom_operateur}}
Date de la demande: {{date_demande}}

Décision:
☐ Acceptée ☐ Refusée
Motif: ________________', 
'actif', 'pdf', '{"nom_hotel": "text", "numero_reservation": "text", "nom_usager": "text", "prenom_usager": "text", "numero_chambre": "text", "date_fin_actuelle": "date", "nouvelle_date_fin": "date", "motif_prolongation": "textarea", "nom_operateur": "text", "date_demande": "date"}'::jsonb),

('Fin de prise en charge', 'fin_prise_charge', 'Document de fin de séjour et bilan', 
'FIN DE PRISE EN CHARGE

Établissement: {{nom_hotel}}
Réservation N°: {{numero_reservation}}

Usager: {{nom_usager}} {{prenom_usager}}
Période d''hébergement: du {{date_arrivee}} au {{date_depart}}
Durée totale: {{duree_totale}} jours

Bilan du séjour:
{{bilan_sejour}}

Orientation de sortie:
{{orientation_sortie}}

Recommandations:
{{recommandations}}

Opérateur social: {{nom_operateur}}
Date de fin: {{date_fin}}', 
'actif', 'pdf', '{"nom_hotel": "text", "numero_reservation": "text", "nom_usager": "text", "prenom_usager": "text", "date_arrivee": "date", "date_depart": "date", "duree_totale": "number", "bilan_sejour": "textarea", "orientation_sortie": "text", "recommandations": "textarea", "nom_operateur": "text", "date_fin": "date"}'::jsonb)

ON CONFLICT DO NOTHING;

-- ====================================
-- 10. MISE À JOUR DES STATISTIQUES
-- ====================================

-- Mettre à jour les statistiques des hôtels
UPDATE public.hotels SET 
    chambres_total = (SELECT COUNT(*) FROM public.rooms WHERE hotel_id = hotels.id),
    chambres_occupees = (SELECT COUNT(*) FROM public.rooms WHERE hotel_id = hotels.id AND statut = 'occupee'),
    taux_occupation = (
        SELECT CASE 
            WHEN COUNT(*) > 0 THEN 
                ROUND((COUNT(*) FILTER (WHERE statut = 'occupee')::DECIMAL / COUNT(*)::DECIMAL) * 100, 2)
            ELSE 0 
        END
        FROM public.rooms 
        WHERE hotel_id = hotels.id
    );

-- Mettre à jour le nombre de réservations des opérateurs
UPDATE public.operateurs_sociaux SET
    nombre_reservations = (
        SELECT COUNT(*) 
        FROM public.reservations 
        WHERE operateur_id = operateurs_sociaux.id
    );

-- ====================================
-- DONNÉES DE TEST CRÉÉES AVEC SUCCÈS
-- ====================================

-- Affichage du résumé des données créées
SELECT 
    'Utilisateurs' as table_name, COUNT(*) as count FROM public.users
UNION ALL SELECT 'Hôtels', COUNT(*) FROM public.hotels
UNION ALL SELECT 'Catégories de chambres', COUNT(*) FROM public.room_categories  
UNION ALL SELECT 'Chambres', COUNT(*) FROM public.rooms
UNION ALL SELECT 'Opérateurs sociaux', COUNT(*) FROM public.operateurs_sociaux
UNION ALL SELECT 'Clients', COUNT(*) FROM public.clients
UNION ALL SELECT 'Usagers', COUNT(*) FROM public.usagers
UNION ALL SELECT 'Conventions prix', COUNT(*) FROM public.conventions_prix
UNION ALL SELECT 'Réservations', COUNT(*) FROM public.reservations
UNION ALL SELECT 'Modèles de documents', COUNT(*) FROM public.document_templates
ORDER BY table_name;